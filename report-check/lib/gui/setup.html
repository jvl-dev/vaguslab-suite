<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="theme.css">
<link rel="stylesheet" href="components.css">
<script>
// Apply theme immediately (before paint) to prevent lightâ†’dark flash
(function() {
    var m = location.search.match(/[?&]theme=(dark|light)/);
    if (m) document.documentElement.dataset.theme = m[1];
})();
</script>
<style>
body {
    background: var(--color-bg);
    height: 100vh;
}
.main {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: var(--color-bg);
}
.content {
    flex: 1;
    overflow-y: auto;
    padding: 20px 24px;
}
/* Form Controls - page-specific overrides (base styles in components.css) */
.form-group label { min-width: 100px; }
.api-status {
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    font-size: 12px;
    margin-top: 4px;
    display: none;
}
.api-status.info { background: var(--color-primary-light); color: var(--color-primary); }
.api-status.success { background: var(--color-success-bg); color: var(--color-success); }
.api-status.error { background: var(--color-danger-bg); color: var(--color-danger); }
.footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 12px 16px;
    background: var(--color-bg-card);
    border-top: 1px solid var(--color-border);
    gap: 12px;
    flex-shrink: 0;
}
.source-link {
    font-size: 12px;
    color: var(--color-text-secondary);
    margin-top: 2px;
}
.source-link a {
    color: var(--color-primary);
    text-decoration: none;
}
.source-link a:hover {
    text-decoration: underline;
}
</style>
</head>
<body>

<!-- Title Bar -->
<div class="titlebar">
    <span class="titlebar-text">First Time Setup - API Key Configuration</span>
    <span class="titlebar-btn" onclick="ahk.SkipSetup()" title="Close">&#x72;</span>
</div>

<div class="main">
<div class="content">

<div class="card">
    <div class="card-description">Welcome! Configure an API key to get started.</div>
</div>

<div class="card">
    <div class="card-header">Provider</div>
    <div class="form-group">
        <label>AI Provider:</label>
        <select id="Provider" onchange="onProviderChange()">
            <option value="claude">Claude (Anthropic)</option>
            <option value="gemini">Gemini (Google)</option>
            <option value="openai">OpenAI</option>
        </select>
    </div>
    <div class="source-link" id="sourceLink">Get your key at: <a href="#" onclick="return false;">https://console.anthropic.com/</a></div>
</div>

<div class="card">
    <div class="card-header">API Key</div>
    <div class="form-group">
        <label id="apiKeyLabel">Key:</label>
        <input type="password" id="APIKey" placeholder="Enter your API key">
        <button class="btn btn-primary flex-shrink-0" id="btnTest" onclick="onTestKey()">Test</button>
    </div>
    <div id="apiStatus" class="api-status"></div>
</div>

</div><!-- end content -->

<div class="footer">
    <button class="btn btn-secondary" onclick="ahk.SkipSetup()">Skip</button>
    <button class="btn btn-primary" id="btnSave" onclick="onSave()">Save</button>
</div>

</div><!-- end main -->

<!-- Modal Dialog -->
<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===event.currentTarget)hideModal()">
    <div class="modal-dialog">
        <div class="modal-header">
            <span class="modal-icon" id="modalIcon"></span>
            <span id="modalTitle"></span>
        </div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-footer" id="modalFooter"></div>
    </div>
</div>

<script>
const PROVIDER_URLS = {
    claude: 'https://console.anthropic.com/',
    gemini: 'https://aistudio.google.com/app/apikey',
    openai: 'https://platform.openai.com/api-keys'
};
const PROVIDER_LABELS = {
    claude: 'Claude (Anthropic)',
    gemini: 'Gemini (Google)',
    openai: 'OpenAI'
};

function onProviderChange() {
    var provider = document.getElementById('Provider').value;
    var url = PROVIDER_URLS[provider] || PROVIDER_URLS.claude;
    document.getElementById('sourceLink').innerHTML = 'Get your key at: <a href="#" onclick="return false;">' + url + '</a>';
    // Clear status when switching
    var status = document.getElementById('apiStatus');
    status.style.display = 'none';
    status.textContent = '';
}

function getFormData() {
    return JSON.stringify({
        Provider: document.getElementById('Provider').value,
        APIKey: document.getElementById('APIKey').value
    });
}

function onTestKey() {
    var key = document.getElementById('APIKey').value;
    if (!key) {
        setStatus('Please enter an API key first', 'error');
        return;
    }
    ahk.TestSetupKey(getFormData());
}

function onSave() {
    var key = document.getElementById('APIKey').value;
    if (!key) {
        setStatus('Please enter an API key', 'error');
        return;
    }
    ahk.SaveSetupKey(getFormData());
}

function setStatus(message, type) {
    var el = document.getElementById('apiStatus');
    el.textContent = message;
    el.className = 'api-status ' + (type || 'info');
    el.style.display = 'block';
}

function setButtonsEnabled(enabled) {
    document.getElementById('btnTest').disabled = !enabled;
    document.getElementById('btnSave').disabled = !enabled;
}

/* Modal (minimal version for setup) */
const MODAL_ICONS = {
    error:   { cls: 'modal-icon-error',   text: '!' },
    warning: { cls: 'modal-icon-warning', text: '!' },
    info:    { cls: 'modal-icon-info',    text: 'i' },
    success: { cls: 'modal-icon-success', text: '\u2713' }
};
function showModal(title, body, icon) {
    var overlay = document.getElementById('modalOverlay');
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalBody').innerHTML = body;
    var iconCfg = MODAL_ICONS[icon] || MODAL_ICONS.info;
    document.getElementById('modalIcon').className = 'modal-icon ' + iconCfg.cls;
    document.getElementById('modalIcon').textContent = iconCfg.text;
    var footer = document.getElementById('modalFooter');
    footer.innerHTML = '';
    var btn = document.createElement('button');
    btn.className = 'btn btn-primary';
    btn.textContent = 'OK';
    btn.onclick = hideModal;
    footer.appendChild(btn);
    overlay.classList.add('active');
}
function hideModal() {
    document.getElementById('modalOverlay').classList.remove('active');
}
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && document.getElementById('modalOverlay').classList.contains('active')) hideModal();
});
</script>
</body>
</html>
